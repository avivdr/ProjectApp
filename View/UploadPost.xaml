<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ProjectApp.View.UploadPost"
             Title="UploadPost"
             xmlns:ViewModel="clr-namespace:ProjectApp.ViewModel"
             x:DataType="ViewModel:UploadPostViewModel"
             xmlns:Model="clr-namespace:ProjectApp.Model">
    <ScrollView>
        <VerticalStackLayout Spacing="20">
            <Label Text="Title"/>
            <Entry Text="{Binding Title}"/>

            <Label Text="Content"/>
            <Editor Text="{Binding Content}" />

            <VerticalStackLayout>
                <Button Text="Pick File" Command="{Binding PickFileCommand}"/>
                <Label Text="{Binding File.FileName}"/>
            </VerticalStackLayout>

            <VerticalStackLayout>
                <Label Text="search composer/work"/>
                <HorizontalStackLayout>
                    <Entry Text="{Binding Query}" WidthRequest="200"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>

            <HorizontalStackLayout>
                <CollectionView 
                    Header="Composers"
                    ItemsSource="{Binding ComposerResults}" 
                    SelectedItem="{Binding Selection}" 
                    WidthRequest="300"
                    VerticalScrollBarVisibility="Always"
                    MaximumHeightRequest="250">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="Model:Composer">
                            <Label Text="{Binding CompleteName}"/>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <CollectionView
                    Header="Works"
                    ItemsSource="{Binding WorkResults}" 
                    SelectedItem="{Binding Selection}" 
                    WidthRequest="400"
                    VerticalScrollBarVisibility="Always"
                    MaximumHeightRequest="250"
                    RemainingItemsThreshold="5"
                    RemainingItemsThresholdReachedCommand="{Binding LoadMoreWorks}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="Model:Work">
                            <Label Text="{Binding TitleWithComposersName}"/>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </HorizontalStackLayout>


            <Label Text="{Binding ErrorMessage}" IsVisible="{Binding IsErrorMessage}"/>

            <Button Text="Post" Command="{Binding PostCommand}"/>
        </VerticalStackLayout>
    </ScrollView>    
</ContentPage>
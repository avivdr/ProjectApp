<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ProjectApp.View.UploadPost"
             Title="UploadPost"
             xmlns:ViewModel="clr-namespace:ProjectApp.ViewModel"
             x:DataType="ViewModel:UploadPostViewModel"
             xmlns:Model="clr-namespace:ProjectApp.Model">
    <ScrollView>
        <VerticalStackLayout Spacing="20">
            <Label Text="Title"/>
            <Entry Text="{Binding Title}"/>

            <Label Text="Content"/>
            <Editor Text="{Binding Content}" />

            <VerticalStackLayout>
                <Button Text="Pick File" Command="{Binding PickFileCommand}"/>
                <Label Text="{Binding File.FileName}"/>
            </VerticalStackLayout>

            <VerticalStackLayout>
                <Label Text="search composer/work"/>
                <HorizontalStackLayout>
                    <Entry Text="{Binding Query}" WidthRequest="200"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>

            <HorizontalStackLayout Spacing="40">
                <VerticalStackLayout Spacing="5">
                    <Label Text="Composers"/>
                    <CollectionView
                        ItemsSource="{Binding ComposerResults}" 
                        SelectedItem="{Binding Selection}" 
                        MaximumWidthRequest="300"
                        VerticalScrollBarVisibility="Always"
                        MaximumHeightRequest="250"
                        EmptyView="No results found :(">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="Model:Composer">
                                <Label Text="{Binding CompleteName}"/>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="5">
                    <Label Text="Works"/>
                    <CollectionView
                        ItemsSource="{Binding WorkResults}" 
                        SelectedItem="{Binding Selection}" 
                        MaximumWidthRequest="400"
                        VerticalScrollBarVisibility="Always"
                        MaximumHeightRequest="250"
                        RemainingItemsThreshold="9"
                        RemainingItemsThresholdReachedCommand="{Binding LoadMoreWorks}"
                        EmptyView="No results found :(">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="Model:Work">
                                <Label Text="{Binding TitleWithComposersName}"/>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </HorizontalStackLayout>


            <Label Text="{Binding ErrorMessage}" IsVisible="{Binding IsErrorMessage}"/>

            <Button Text="Post" Command="{Binding PostCommand}"/>
        </VerticalStackLayout>
    </ScrollView>    
</ContentPage>